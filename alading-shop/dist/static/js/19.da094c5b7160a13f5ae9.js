webpackJsonp([19],{"5hbo":function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a={components:{EditGoods:e("Ypil").a},data:function(){return{id:"",limit:{}}},created:function(){this.getParams()},beforeRouteEnter:function(t,i,e){var a=localStorage.getItem("joinableActivityGoods");a&&+(a=JSON.parse(a)).activityId==+t.query.id?e():e(function(t){t.$router.push({name:"joinableActivityDetail",query:{id:t.id}})})},methods:{getParams:function(){this.id=this.$route.query.id,this.limit={minAmount:this.$route.query.minAmount,maxAmount:this.$route.query.maxAmount,priceDemand:this.$route.query.priceDemand,priceDisDemand:this.$route.query.priceDisDemand}}}},n={render:function(){var t=this.$createElement,i=this._self._c||t;return i("div",{staticClass:"editActivityGoods"},[i("EditGoods",{attrs:{id:this.id,limit:this.limit}})],1)},staticRenderFns:[]};var o=e("VU/8")(a,n,!1,function(t){e("Up+M")},"data-v-9d072038",null);i.default=o.exports},"9WEG":function(t,i,e){(t.exports=e("FZ+f")(!1)).push([t.i,"\n.tip[data-v-0c03233d] {\n  text-align: right;\n  color: #999;\n  padding-bottom: 5px;\n}\n.btnBox[data-v-0c03233d] {\n  padding-top: 30px;\n  padding-right: 50px;\n  text-align: right;\n}\n.cell .el-form-item[data-v-0c03233d] {\n  margin-bottom: 0;\n}\n.cell .el-form-item.is-success[data-v-0c03233d] .el-input__inner {\n  border-color: #dcdfe6;\n}\n.cell .el-form-item__error[data-v-0c03233d] {\n  display: none;\n}\n.el-table--medium td[data-v-0c03233d],\n.el-table--medium th[data-v-0c03233d] {\n  padding: 2px 0;\n}\n.imgBox[data-v-0c03233d] {\n  width: 60px;\n  height: 60px;\n}\n.imgBox img[data-v-0c03233d] {\n  width: auto;\n  max-height: 100%;\n}\n.limit[data-v-0c03233d] {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-wrap: wrap;\n      flex-wrap: wrap;\n}\n.limit li[data-v-0c03233d] {\n  width: 300px;\n  padding-bottom: 10px;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n}\n.limit .title[data-v-0c03233d] {\n  width: 130px;\n}\n.limit .content[data-v-0c03233d] {\n  color: #666;\n}\n",""])},HENW:function(t,i,e){(t.exports=e("FZ+f")(!1)).push([t.i,"\n.editActivityGoods[data-v-9d072038] {\n  padding: 20px;\n}\n",""])},"Up+M":function(t,i,e){var a=e("HENW");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);e("rjj0")("7baf87ac",a,!0)},Uyx3:function(t,i,e){var a=e("9WEG");"string"==typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);e("rjj0")("13ed6e40",a,!0)},Ypil:function(t,i,e){"use strict";var a=e("Gu7T"),n=e.n(a),o=e("1onU"),s=e("8ghC"),l={props:["id","goodsId","callback","limit"],components:{Pagination:o.a},data:function(){var t=this;return{model:{rules:{specialPrice:[{validator:function(i,e,a){if(e&&(e=+e),!e)return t.$message({type:"warning",message:"活动价不能为空"}),a(new Error(""));var n=i.field.slice(i.field.indexOf(".")+1,i.field.lastIndexOf(".")),o=+t.model.tableData[n].saleAmount,s="售价";if(t.limit.priceDemand&&+t.limit.priceDemand<o?s=o=+t.limit.priceDemand:t.limit.priceDisDemand&&(o=o*+t.limit.priceDisDemand/10,s="售价的"+t.limit.priceDisDemand+"折"),e>o)return t.$message({type:"warning",message:"活动价不能大于"+s}),a(new Error(""));a()},trigger:"blur"}],limitCount:[{validator:function(i,e,a){if(e&&(e=+e),!e)return t.$message({type:"warning",message:"活动库存不能为空"}),a(new Error(""));var n=i.field.slice(i.field.indexOf(".")+1,i.field.lastIndexOf("."));return e>t.model.tableData[n].stock?(t.$message({type:"warning",message:"活动库存不能大于该规格剩余库存"}),a(new Error(""))):t.amountLimitJudge(t.model.tableData[n].goodsId)?(t.$message({type:"warning",message:"商品活动库存不符合要求"}),a(new Error(""))):void a()},trigger:"blur"}]},tableData:[]},totalData:[],pageNo:1,pageSize:20,totalCount:0,times:0,type:null,min:0,max:0,deleteIds:[]}},created:function(){this.init()},computed:{priceLimit:function(){return this.limit.priceDemand?"<= "+this.limit.priceDemand+"元":this.limit.priceDisDemand?"<= "+this.limit.priceDisDemand+"折":"不限"},stockLimit:function(){return this.limit.minAmount&&this.limit.maxAmount?this.limit.minAmount+" ~ "+this.limit.maxAmount:this.limit.minAmount?">= "+this.limit.minAmount:this.limit.maxAmount?"<= "+this.limit.maxAmount:"不限"}},methods:{init:function(){if(console.log(this.limit),this.type=this.$route.query.type,this.min=this.$route.query.min||this.limit.pintuanManMin,this.max=this.$route.query.max||this.limit.pintuanManMax,this.limit.editTimes?this.times=this.limit.editTimes:this.times=this.$route.query.min||this.limit.pintuanManMin,this.goodsId)this.getTypeGoodsList(this.goodsId);else{var t=JSON.parse(localStorage.getItem("joinableActivityGoods"));if(t&&+t.activityId==+this.$route.query.id){var i=t.data.map(function(t){return t.id}).join();this.getTypeGoodsList(i)}}},getPeopleNum:function(t){return t<=this.min?(this.times=this.min,!1):t>=this.max?(this.times=this.max,!1):void 0},handleChange:function(t){console.log(t)},getTypeGoodsList:function(t){var i=this,e={activityEnterId:this.id},a=null;this.goodsId?(a=s.k,e.goodsId=t):(a=s.s,e.goodsIds=t),a(e).then(function(t){i.totalData=t.data,i.totalCount=i.totalData.length,i.totalData.forEach(function(t){t.specialPrice||(t.specialPrice=void 0),t.limitCount||(t.limitCount=void 0)}),0!==i.totalCount||i.goodsId||i.$message({type:"warning",message:"您选择的商品都已存在报名详情列表，请返回重选",duration:5e3}),i.getTableData()})},handleCurrentChange:function(t){var i;(i=this.totalData).splice.apply(i,[this.pageSize*(this.pageNo-1),this.model.tableData.length].concat(n()(this.model.tableData))),this.$refs.checkForm.clearValidate(),this.pageNo=t,this.getTableData()},getTableData:function(){var t=this.pageSize*(this.pageNo-1);this.pageNo>=this.totalCount/this.pageSize?(this.model.tableData=this.totalData.slice(t),this.model.tableData.length<=0&&this.pageNo>1&&(this.pageNo--,this.getTableData())):this.model.tableData=this.totalData.slice(t,t+this.pageSize)},delGoods:function(t){var i=this;this.$confirm("确定删除该项？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){i.totalData.splice(i.pageSize*(i.pageNo-1)+t.$index,1),i.totalCount=i.totalData.length,i.getTableData(),i.$refs.checkForm.clearValidate(),i.deleteIds.push(t.row.id)}).catch(function(){})},submitList:function(t){var i=this;this.$refs.checkForm.validate(function(t,e){if(t&&i.globalValidate()){var a={activityEnterId:+i.id,activityEnterGoodsVos:[],times:i.times};i.totalData.forEach(function(t,e){var n={goodsId:t.goodsId,priceId:t.priceId,specialPrice:t.specialPrice,limitCount:t.limitCount};i.goodsId&&(n.id=t.id),a.activityEnterGoodsVos.push(n)}),i.goodsId?(a.enterActivityGoodsIds=i.deleteIds.join(),Object(s.G)(a).then(function(t){i.$emit("callback",{isSubmit:!0}),i.$message({type:"success",message:"保存成功"})})):Object(s.B)(a).then(function(t){localStorage.removeItem("joinableActivityGoods"),i.$message({type:"success",message:"提交成功"}),i.$router.push({name:"joinableActivityDetail",query:{id:i.id,type:i.type}})})}})},globalValidate:function(){for(var t=this,i=0;i<this.totalData.length;i++)if(this.priceValidate(this.totalData[i])||this.amountValidate(this.totalData[i])){var e=i>=this.pageSize?Math.ceil((i+1)/this.pageSize):1;return this.handleCurrentChange(e),this.$nextTick(function(){t.$refs.checkForm.validate(function(){})}),!1}return!0},priceValidate:function(t){var i=+t.saleAmount;if(this.limit.priceDemand&&+this.limit.priceDemand<i?i=+this.limit.priceDemand:this.limit.priceDisDemand&&(i=i*+this.limit.priceDisDemand/10),!t.specialPrice||t.specialPrice>i)return!0},amountValidate:function(t){if((t.limitCount||0===t.limitCount)&&(!t.limitCount||t.limitCount>t.stock||this.amountLimitJudge(t.goodsId)))return!0},amountLimitJudge:function(t){var i={};this.totalData.forEach(function(t,e){i[t.goodsId]||(i[t.goodsId]=[]),i[t.goodsId].push(t)});for(var e=0,a=0;a<i[t].length;a++){if(!i[t][a].limitCount)return!1;e+=+i[t][a].limitCount}return!!(this.limit.minAmount&&e<+this.limit.minAmount)||(!!(this.limit.maxAmount&&e>+this.limit.maxAmount)||void 0)},goBack:function(){this.goodsId?this.$emit("callback",{isSubmit:!1}):this.$router.push({name:"joinableActivityDetail",query:{id:this.id}})}}},r={render:function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("div",{staticClass:"editGoods"},[e("ul",{staticClass:"limit"},[e("li",[e("span",{staticClass:"title"},[t._v("商品活动库存要求：")]),t._v(" "),e("span",{staticClass:"content"},[t._v(t._s(t.stockLimit))])]),t._v(" "),e("li",[e("span",{staticClass:"title"},[t._v("商品活动价格要求：")]),t._v(" "),e("span",{staticClass:"content"},[t._v(t._s(t.priceLimit))])])]),t._v(" "),e("p",{staticClass:"tip"},[t._v("商品活动库存要求，是针对同一商品下所有规格的活动库存之和")]),t._v(" "),e("el-form",{ref:"checkForm",attrs:{model:t.model,rules:t.model.rules}},[e("el-table",{attrs:{data:t.model.tableData,stripe:""}},[e("el-table-column",{attrs:{prop:"goodsId",label:"商品ID"}}),t._v(" "),e("el-table-column",{attrs:{label:"商品图片"},scopedSlots:t._u([{key:"default",fn:function(t){return[e("div",{staticClass:"imgBox"},[e("img",{attrs:{src:t.row.goodsIcon,alt:""}})])]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"name",label:"商品名称","min-width":"150"}}),t._v(" "),e("el-table-column",{attrs:{prop:"specNames",label:"规格","min-width":"150"}}),t._v(" "),e("el-table-column",{attrs:{prop:"saleAmount",label:"售价"}}),t._v(" "),e("el-table-column",{attrs:{prop:"stock",label:"库存"}}),t._v(" "),e("el-table-column",{attrs:{label:"活动价","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-form-item",{attrs:{prop:"tableData."+i.$index+".specialPrice",rules:t.model.rules.specialPrice}},[e("el-input-number",{attrs:{size:"small","controls-position":"right",min:.01,step:.01,precision:2},model:{value:i.row.specialPrice,callback:function(e){t.$set(i.row,"specialPrice",e)},expression:"scope.row.specialPrice"}})],1)]}}])}),t._v(" "),e("el-table-column",{attrs:{label:"活动库存","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-form-item",{attrs:{prop:"tableData."+i.$index+".limitCount",rules:t.model.rules.limitCount}},[e("el-input-number",{attrs:{size:"small","controls-position":"right",min:1,step:1,precision:0},model:{value:i.row.limitCount,callback:function(e){t.$set(i.row,"limitCount",e)},expression:"scope.row.limitCount"}})],1)]}}])}),t._v(" "),e("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("a",{on:{click:function(e){e.preventDefault(),t.delGoods(i)}}},[t._v("删除")])]}}])})],1)],1),t._v(" "),e("Pagination",{attrs:{pageNo:t.pageNo,pageSize:t.pageSize,totalCount:t.totalCount,handleChange:t.handleCurrentChange}}),t._v(" "),4==t.type?[e("p",{},[e("span",[t._v("成团人数：")]),t._v(" "),0==t.max&&0==t.min?e("span",[t._v("不限")]):e("el-input-number",{attrs:{step:1,min:+t.min,max:+t.max,precision:0},on:{change:t.getPeopleNum},model:{value:t.times,callback:function(i){t.times=i},expression:"times"}})],1),t._v(" "),0!=t.max&&0!=t.min?e("p",{staticStyle:{color:"red","margin-top":"10px","font-size":"12px"}},[t._v("(成团人数必填大于等于"+t._s(t.min)+"且小于等于"+t._s(t.max)+"的正整数)")]):t._e()]:t._e(),t._v(" "),e("div",{staticClass:"btnBox"},[t.model.tableData.length>0?e("el-button",{attrs:{type:"primary"},on:{click:function(i){t.submitList()}}},[t._v("\n        "+t._s(t.goodsId?"保存":"确认提交")+"\n      ")]):e("el-button",{on:{click:function(i){t.goBack()}}},[t._v("\n        "+t._s(t.goodsId?"关闭":"返回重选")+"\n      ")])],1)],2)},staticRenderFns:[]};var m=e("VU/8")(l,r,!1,function(t){e("Uyx3")},"data-v-0c03233d",null);i.a=m.exports}});