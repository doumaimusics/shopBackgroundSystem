webpackJsonp([18],{"1B4J":function(t,i,a){"use strict";var e=a("mvHQ"),n=a.n(e),o=a("8ghC"),r={props:["isAdd","isEdit"],components:{GoodsSelect:a("xkLq").a},data:function(){return{activityFormData:{name:"",type:1,goodsLimitCount:void 0,timeRange:[]},activityRule:{name:[{validator:function(t,i,a){return i.trim()?i.length>30?a(new Error("活动名称不能超多30个字符")):void a():a(new Error("活动名称不能为空"))},trigger:"blur"}],timeRange:[{validator:function(t,i,a){if(!i||i.length<=0)return a(new Error("请选择时间"));a()},trigger:"change"}]},id:"",visible:!1,loading:!1}},created:function(){this.getParams(),this.isEdit&&this.getActivityData()},methods:{getParams:function(){this.id=this.$route.params.id},getActivityData:function(){var t=this,i={id:this.id};Object(o.h)(i).then(function(i){t.activityFormData={name:i.data.name,type:i.data.type,timeRange:[new Date(i.data.gmtStart),new Date(i.data.gmtEnd)]},0!==i.data.goodsLimitCount&&(t.activityFormData.goodsLimitCount=i.data.goodsLimitCount)})},onEdit:function(){var t=this;this.$refs.activityForm.validate(function(i){if(!i)return!1;var a=JSON.parse(n()(t.activityFormData));a.id=t.id,console.log(a),a.gmtStartTime=new Date(a.timeRange[0]).getTime(),a.gmtEndTime=new Date(a.timeRange[1]).getTime(),delete a.timeRange,a.goodsLimitCount||(a.goodsLimitCount=0),Object(o.w)(a).then(function(i){t.$message({message:"保存成功",type:"success"})})})},onCancel:function(){this.$router.push({name:"salesIndex"})},onManage:function(){this.$router.push({name:"manageGood",query:{id:this.id}})},addBtn:function(){var t=this;this.$refs.activityForm.validate(function(i){i&&(t.visible=!0)})},onAdd:function(t){var i=this;this.loading=!0;var a=JSON.parse(n()(this.activityFormData));a.gmtStartTime=this.activityFormData.timeRange[0].getTime(),a.gmtEndTime=this.activityFormData.timeRange[1].getTime(),delete a.timeRange,a.goodsLimitCount||(a.goodsLimitCount=0),Object(o.x)(a).then(function(a){i.addActivityGoods(t,a.data.id)}).catch(function(){i.loading=!1})},addActivityGoods:function(t,i){var a=this,e={goodsIds:t.map(function(t){return t.id}).join(),activityId:i};Object(o.H)(e).then(function(t){a.$message({type:"success",message:"活动商品添加成功"}),a.$router.push({name:"setPrice",query:{id:i}})}).catch(function(){a.loading=!1})}}},s={render:function(){var t=this,i=t.$createElement,a=t._self._c||i;return a("div",{staticClass:"inputActivity",attrs:{loading:t.loading}},[a("el-form",{ref:"activityForm",staticClass:"activityForm",attrs:{model:t.activityFormData,"status-icon":"",rules:t.activityRule}},[a("el-form-item",{attrs:{label:"活动名称：",prop:"name"}},[a("el-input",{staticClass:"inputBox",model:{value:t.activityFormData.name,callback:function(i){t.$set(t.activityFormData,"name",i)},expression:"activityFormData.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"活动类型："}},[a("el-radio",{attrs:{label:1},model:{value:t.activityFormData.type,callback:function(i){t.$set(t.activityFormData,"type",i)},expression:"activityFormData.type"}},[t._v("限时打折")])],1),t._v(" "),a("el-form-item",{attrs:{label:"每人限购：",prop:"goodsLimitCount"}},[a("el-input-number",{attrs:{"controls-position":"right",min:1,max:999,precision:0},model:{value:t.activityFormData.goodsLimitCount,callback:function(i){t.$set(t.activityFormData,"goodsLimitCount",i)},expression:"activityFormData.goodsLimitCount"}})],1),t._v(" "),a("el-form-item",{staticClass:"timeLine",attrs:{label:"活动时间：",prop:"timeRange"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.activityFormData.timeRange,callback:function(i){t.$set(t.activityFormData,"timeRange",i)},expression:"activityFormData.timeRange"}})],1),t._v(" "),t.isEdit?a("el-form-item",{attrs:{label:""}},[a("el-button",{attrs:{type:"primary"},on:{click:t.onManage}},[t._v("管理活动商品")])],1):t._e(),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"default"},on:{click:t.onCancel}},[t._v("返回")]),t._v(" "),t.isEdit?a("el-button",{attrs:{type:"primary"},on:{click:t.onEdit}},[t._v("保存")]):t._e(),t._v(" "),t.isAdd?a("el-button",{attrs:{type:"primary"},on:{click:t.addBtn}},[t._v("选择活动商品")]):t._e()],1)],1),t._v(" "),a("GoodsSelect",{attrs:{isShow:t.visible,onSubmit:t.onAdd},on:{"update:isShow":function(i){t.visible=i}}})],1)},staticRenderFns:[]};var c=a("VU/8")(r,s,!1,function(t){a("eHum")},"data-v-b1f9cf9a",null);i.a=c.exports},Mljy:function(t,i,a){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e={data:function(){return{}},created:function(){},methods:{},components:{InputActivity:a("1B4J").a}},n={render:function(){var t=this.$createElement,i=this._self._c||t;return i("div",{staticClass:"addAct"},[i("InputActivity",{attrs:{isEdit:!0}})],1)},staticRenderFns:[]};var o=a("VU/8")(e,n,!1,function(t){a("V2WY")},"data-v-103d9faa",null);i.default=o.exports},V2WY:function(t,i,a){var e=a("nx+j");"string"==typeof e&&(e=[[t.i,e,""]]),e.locals&&(t.exports=e.locals);a("rjj0")("51a83d4c",e,!0)},"Z+P1":function(t,i,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.inputActivity .inputBox[data-v-b1f9cf9a] {\n  display: inline-block;\n  width: 40%;\n}\n.inputActivity[data-v-b1f9cf9a] .el-form-item__error {\n  left: 85px;\n}\n.inputActivity .timeLine[data-v-b1f9cf9a] {\n  display: inline-block;\n  width: 550px;\n}\n",""])},eHum:function(t,i,a){var e=a("Z+P1");"string"==typeof e&&(e=[[t.i,e,""]]),e.locals&&(t.exports=e.locals);a("rjj0")("4686b264",e,!0)},"nx+j":function(t,i,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.addAct[data-v-103d9faa] {\n  padding: 20px;\n}\n",""])}});