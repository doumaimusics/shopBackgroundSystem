webpackJsonp([11],{"1Jx3":function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.goodSelectBox[data-v-c0bb959a] {\n  margin-bottom: 25px;\n}\n.goodSelectBox .del[data-v-c0bb959a] {\n  color: #409eff;\n  cursor: pointer;\n}\n.goodSelectBox .setBtn[data-v-c0bb959a] {\n  margin-bottom: 20px;\n}\n.goodSelectBox .el-dialog__body[data-v-c0bb959a] {\n  padding: 20px 30px 0 30px !important;\n}\n.goodSelectBox .btnBox[data-v-c0bb959a] {\n  margin-top: 30px;\n  text-align: right;\n}\n.goodSelectBox a[data-v-c0bb959a] {\n  color: #409EFF;\n}\n.goodSelectBox .cell .el-form-item[data-v-c0bb959a] {\n  margin-bottom: 0;\n}\n.goodSelectBox .cell .el-form-item.is-success[data-v-c0bb959a] .el-input__inner {\n  border-color: #dcdfe6;\n}\n.goodSelectBox .cell .el-form-item__error[data-v-c0bb959a] {\n  display: none;\n}\n.goodSelectBox .el-table--medium td[data-v-c0bb959a],\n.goodSelectBox .el-table--medium th[data-v-c0bb959a] {\n  padding: 2px 0;\n}\n.priceDialog[data-v-c0bb959a] .el-form-item__error {\n  margin-left: 80px;\n}\n.table[data-v-c0bb959a] {\n  width: 100%;\n  color: #606266;\n}\n.table[data-v-c0bb959a],\n.table tr th[data-v-c0bb959a],\n.table tr td[data-v-c0bb959a] {\n  border: 1px solid #ccc;\n}\n.table th[data-v-c0bb959a] {\n  text-align: left;\n  color: grey;\n  padding: 10px;\n}\n.table td[data-v-c0bb959a] {\n  padding: 5px 10px;\n}\n.table .el-input[data-v-c0bb959a] {\n  width: 80%;\n}\n.table .goodsName[data-v-c0bb959a] {\n  max-width: 50px;\n}\n.table .el-form-item[data-v-c0bb959a] {\n  margin-bottom: 0;\n  border-color: #ccc;\n}\n.table .el-form-item.is-success .el-input__inner[data-v-c0bb959a] {\n  border-color: #dcdfe6;\n}\n.table .el-form-item__error[data-v-c0bb959a] {\n  display: none;\n}\n.table .noData[data-v-c0bb959a] {\n  text-align: center;\n  padding: 10px 0;\n  color: #999;\n}\n",""])},APsm:function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.setPriceBox[data-v-629b5790] {\n  padding: 20px;\n}\n",""])},bc7Z:function(t,e,a){"use strict";var i=a("fZjL"),n=a.n(i),r=a("8ghC"),o=a("xkLq"),c=a("1onU"),s={props:["id","isManageActivity"],components:{GoodsSelect:o.a,Pagination:c.a},data:function(){var t=this,e={checkActivityPrice:function(e,a,i){if(!a&&0!==a)return t.isJump||t.$message({type:"warning",message:"活动价格不能为空"}),i(new Error(""));if(a<=0)return t.isJump||t.$message({type:"warning",message:"活动价格需大于0"}),i(new Error(""));var n=e.field.slice(e.field.indexOf(".")+1,e.field.lastIndexOf("."));if(a>t.model.tableData[n].actualAmount)return t.isJump||t.$message({type:"warning",message:"活动价格不能大于售价"}),i(new Error(""));i()},checkActivityAmount:function(e,a,i){if(a){if(!/^[1-9][0-9]*$/.test(a))return t.isJump||t.$message({type:"warning",message:"活动库存需为大于0的整数数字"}),i(new Error(""));var n=e.field.slice(e.field.indexOf(".")+1,e.field.lastIndexOf("."));if(a>t.model.tableData[n].stock)return t.isJump||t.$message({type:"warning",message:"活动库存不能大于剩余库存"}),i(new Error(""))}i()},checkPriceMinus:function(e,a,i){var n=t.priceFormData.price;if(!n)return i(new Error("请输入数字"));if(0===t.priceFormData.type){if(n<=0||n>1)return i(new Error("折扣需大于0且不大于1"))}else if(1===t.priceFormData.type&&n<0)return i(new Error("直降需大于等于0"));i()}};return{model:{rules:{specialPrice:[{validator:e.checkActivityPrice,trigger:"blur"}],limitCount:[{validator:e.checkActivityAmount,trigger:"blur"}]},tableData:[]},priceVisible:!1,priceFormData:{price:"",type:0},priceRules:{priceMinus:[{validator:e.checkPriceMinus,trigger:"blur"}]},pagination:{currentPage:1,pageSize:20,totalCount:0},isJump:!1,visible:!1}},created:function(){this.getActivityGoods()},computed:{priceFormType:function(){return this.priceFormData.type}},watch:{priceFormType:function(){this.priceFormData.price="",this.$refs.restartForm&&this.$refs.restartForm.clearValidate()}},methods:{getActivityGoods:function(){var t=this,e={activityId:this.id};e.pageNo=this.pagination.currentPage,Object(r.g)(e).then(function(a){a.data.length<=0&&e.pageNo>1?t.handleCurrentChange(1):(a.data.forEach(function(t){0===t.specialPrice&&(t.specialPrice=""),t.limitCount}),t.model.tableData=a.data,t.pagination.totalCount=a.totalCount,t.pagination.pageSize=a.pageSize)})},goBack:function(){this.$router.push({name:"editActivity",params:{id:this.id}})},delGoods:function(t){var e=this;this.$confirm("确定删除该项？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={id:t,activityId:e.id};Object(r.E)(a).then(function(t){e.$message({message:"删除成功！",type:"success"}),e.handleCurrentChange(e.pagination.currentPage)})}).catch(function(){})},submitPrice:function(){var t=this;this.$refs.restartForm.validate(function(e){e&&(t.priceVisible=!1,t.model.tableData.forEach(function(e,a){e.specialPrice=t.priceFormData.type?e.actualAmount-t.priceFormData.price:e.actualAmount*t.priceFormData.price,e.specialPrice<=0&&(e.specialPrice=.1),e.specialPrice=Math.round(100*e.specialPrice)/100}),t.$message({message:"价格设置成功",type:"success"}))})},submitList:function(t){var e=this;t&&(this.isJump=!0),this.$refs.checkForm.validate(function(a,i){var o=[];if(n()(i).forEach(function(t){o.push(+t.slice(t.indexOf(".")+1,t.lastIndexOf(".")))}),o.length!==e.model.tableData.length){var c={activityId:e.id,aglist:[]};e.model.tableData.forEach(function(t,e){-1===o.indexOf(e)&&c.aglist.push({id:t.id,specialPrice:t.specialPrice,limitCount:t.limitCount})}),Object(r.v)(c).then(function(i){t||(a?e.$message({type:"success",message:"保存成功"}):e.$message({type:"success",message:"部分保存成功",duration:1e3}))})}}),this.isJump=!1},addBtn:function(){this.visible=!0},addGoods:function(t){var e=this,a={goodsIds:t.map(function(t){return t.id}).join(),activityId:this.id};Object(r.H)(a).then(function(t){e.$message({type:"success",message:"活动商品添加成功"}),e.handleCurrentChange(1)})},showDialog:function(){this.model.tableData.length<=0?this.$message({type:"warning",message:"暂无商品"}):(this.priceVisible=!0,this.$refs.restartForm&&this.$refs.restartForm.clearValidate(),this.priceFormData={type:0,price:""})},handleCurrentChange:function(t){t!==this.pagination.currentPage&&(this.submitList(!0),this.$refs.checkForm.clearValidate()),this.pagination.currentPage=t,this.getActivityGoods()}}},l={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"goodSelectBox"},[a("el-button",{staticClass:"setBtn",attrs:{type:"primary"},on:{click:t.showDialog}},[t._v("批量设置活动价格")]),t._v(" "),t.isManageActivity?a("el-button",{staticClass:"setBtn",attrs:{type:"primary"},on:{click:t.addBtn}},[t._v("新增活动商品")]):t._e(),t._v(" "),a("el-form",{ref:"checkForm",attrs:{model:t.model,rules:t.model.rules}},[a("el-table",{attrs:{data:t.model.tableData,stripe:""}},[a("el-table-column",{attrs:{prop:"goodsId",label:"商品ID"}}),t._v(" "),a("el-table-column",{attrs:{prop:"name",label:"商品","min-width":"150"}}),t._v(" "),a("el-table-column",{attrs:{prop:"specNames",label:"规格","min-width":"100"}}),t._v(" "),a("el-table-column",{attrs:{prop:"actualAmount",label:"售价"}}),t._v(" "),a("el-table-column",{attrs:{prop:"stock",label:"剩余库存"}}),t._v(" "),a("el-table-column",{attrs:{label:"活动价格"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form-item",{attrs:{prop:"tableData."+e.$index+".specialPrice",rules:t.model.rules.specialPrice}},[a("el-input",{attrs:{type:"number",size:"small"},model:{value:e.row.specialPrice,callback:function(a){t.$set(e.row,"specialPrice",a)},expression:"scope.row.specialPrice"}})],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("a",{on:{click:function(a){a.preventDefault(),t.delGoods(e.row.id)}}},[t._v("删除")])]}}])})],1)],1),t._v(" "),a("Pagination",{attrs:{pageNo:t.pagination.currentPage,pageSize:t.pagination.pageSize,totalCount:t.pagination.totalCount,handleChange:t.handleCurrentChange}}),t._v(" "),a("div",{staticClass:"btnBox"},[a("el-button",{attrs:{type:"default"},on:{click:t.goBack}},[t._v("返回")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.submitList()}}},[t._v("保存")])],1),t._v(" "),a("el-dialog",{staticClass:"priceDialog",attrs:{visible:t.priceVisible,width:"300px",title:"只针对当前页"},on:{"update:visible":function(e){t.priceVisible=e}}},[a("el-form",{ref:"restartForm",attrs:{model:t.priceFormData,rules:t.priceRules}},[a("el-form-item",{attrs:{label:"优惠方式："}},[a("el-radio-group",{model:{value:t.priceFormData.type,callback:function(e){t.$set(t.priceFormData,"type",e)},expression:"priceFormData.type"}},[a("el-radio",{attrs:{label:0}},[t._v("折扣")]),t._v(" "),a("el-radio",{attrs:{label:1}},[t._v("直降")])],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"优惠力度：",prop:"priceMinus"}},[a("el-input",{staticStyle:{width:"138px"},attrs:{type:"number",placeholder:0==t.priceFormData.type?"输入折扣":"输入直降金额"},model:{value:t.priceFormData.price,callback:function(e){t.$set(t.priceFormData,"price",e)},expression:"priceFormData.price"}})],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.priceVisible=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.submitPrice}},[t._v("确定")])],1)],1),t._v(" "),a("GoodsSelect",{attrs:{isShow:t.visible,onSubmit:t.addGoods},on:{"update:isShow":function(e){t.visible=e}}})],1)},staticRenderFns:[]};var d=a("VU/8")(s,l,!1,function(t){a("uVcA")},"data-v-c0bb959a",null);e.a=d.exports},e2vf:function(t,e,a){var i=a("APsm");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("00c3ce2d",i,!0)},uVcA:function(t,e,a){var i=a("1Jx3");"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);a("rjj0")("5867a972",i,!0)},zO9d:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i={components:{GoodTable:a("bc7Z").a},data:function(){return{id:""}},created:function(){this.getParams()},methods:{getParams:function(){this.id=this.$route.query.id}}},n={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"setPriceBox"},[e("GoodTable",{attrs:{id:this.id}})],1)},staticRenderFns:[]};var r=a("VU/8")(i,n,!1,function(t){a("e2vf")},"data-v-629b5790",null);e.default=r.exports}});