webpackJsonp([14],{"4xdC":function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n.addAct[data-v-30f34cad] {\n  padding: 20px;\n}\n",""])},"Cn0+":function(t,e,a){"use strict";var n=a("8ghC"),r=a("TIfe"),o=a("mtWM"),i=a.n(o),s=a("xkLq"),d=a("Emo/"),l=a("GKmE"),c={components:{GoodsSelect:s.a,GoodTable02:d.a},props:["isAdd","isEdit"],data:function(){var t=this,e={validateAmount:function(t,e,a){if("0"===e||!/^\d+(\.\d+)?$/.test(e))return a(new Error("请输入大于0的数字"));a()},validateLimitAmount:function(t,e,a){if(!/^\d+(\.\d+)?$/.test(e))return a(new Error("请输入大于或等于0的数字"));a()},validateDateRange:function(e,a,n){if("R"===t.form.expiryType&&(!a||a.length<=0))return n(new Error("请选择日期范围"));n()},validateValidTime:function(t,e,a){if(!e||e.length<=0)return a(new Error("请选择日期范围"));a()},validateNum:function(e,a,n){if(console.log(a+"--"+t.form.type),0===Number(a))return n(new Error("值不能为0"));if("AMOUNT"===t.form.type||"AMOUNTDISCOUNT"===t.form.type||"AMOUNTCOUNT"===t.form.type){if(a<0||a>=99999.99)return n(new Error("值不能大于99999.99且小于0"));if(!/(^[0-9]+$)|(^[0-9]+[\.]{1}[0-9]{1,2}$)/.test(a))return n(new Error("值可保留两位小数"))}if(("COUNT"===t.form.type||"COUNTDISCOUNT"===t.form.type||"COUNTAMOUNT"===t.form.type)&&!/^[1-9][0-9]{0,1}$/.test(a))return n(new Error("值为不超过100的正整数"));n()},validateNum2:function(e,a,n){if(console.log(t.form.type),0===Number(a))return n(new Error("值不能为0"));if("AMOUNT"===t.form.type||"COUNT"===t.form.type){if(a<0||a>=99999.99)return n(new Error("值不能大于99999.99且小于0"));if(!/(^[0-9]+$)|(^[0-9]+[\.]{1}[0-9]{1,2}$)/.test(a))return n(new Error("值可保留两位小数"))}return"AMOUNTCOUNT"!==t.form.type&&"COUNTAMOUNT"!==t.form.type||/^[1-9][0-9]{0,1}$/.test(a)?"AMOUNTDISCOUNT"!==t.form.type&&"COUNTDISCOUNT"!==t.form.type||!(a<=1||a>=10)?("AMOUNT"===t.form.type||"COUNTAMOUNT"===t.form.type)&&Number(t.form.threshold)<Number(t.form.discountAmount)?(console.log(t.form.threshold+"-"+t.form.discountAmount+"--"+t.form.type),console.log(t.form.threshold<t.form.discountAmount),n(new Error("值需要小于满足的条件"))):void n():n(new Error("值必须大于1小于10，可保留1位小数")):n(new Error("值为不超过100的正整数"))}};return{form:{id:"",name:"",type:"AMOUNT",dateRange:[],start:"",end:"",remark:"",icon:"https://img.51fanbei.com/h5/app/activity/full.png",threshold:"",discountAmount:"",status:"C",discountType:0},useCaseSelect:[{value:1,label:"全场通用"},{value:2,label:"指定商品"}],visible:!1,curGoodData:[],typeData:[{label:"满N元减M元",value:"AMOUNT"},{label:"满N件减M元",value:"COUNT"},{label:"满N元打M折",value:"AMOUNTDISCOUNT"},{label:"满N件打M折",value:"COUNTDISCOUNT"},{label:"满N元任选M件",value:"AMOUNTCOUNT"},{label:"满N件减M件",value:"COUNTAMOUNT"}],rules:{name:[{required:!0,message:"不能为空",trigger:"blur"},{pattern:/^[\s\S]{1,30}$/,message:"名称不能超过30位",trigger:"blur"}],threshold:[{required:!0,message:"不能为空",trigger:"blur"},{validator:e.validateNum,trigger:"blur"}],discountAmount:[{required:!0,message:"不能为空",trigger:"blur"},{validator:e.validateNum2,trigger:"blur"}],useCase:[{required:!0,trigger:"change"}],type:[{required:!0,message:"请选择",trigger:"change"}],dateRange:[{required:!0,validator:e.validateValidTime,trigger:"change"}],remark:[{required:!0,message:"规则说明不能空"},{pattern:/^[\s\S]{1,30}$/,message:"规则说明不能超过30位",trigger:"blur"}]},id:this.$route.params.id,goodData:[],num:0,btnLoading:!1,typeTxt:{name:"元减",label:"元"},GoodsSubmitStatus:!0}},created:function(){this.isEdit&&this.getFullActivity()},methods:{formatTimestamp:l.c,checkNum:function(t,e){(isNaN(t.target.value)||/^-$/.test(t.target.value))&&(0===e?this.form.threshold="":this.form.discountAmount=""),/^[+-]?\d*\.{0,1}\d{0,1}$/.test(t.target.value)||(0===e?this.form.threshold=t.target.value.toString().match(/^\d+(?:\.\d{0,2})?/):this.form.discountAmount=t.target.value.toString().match(/^\d+(?:\.\d{0,2})?/))},addExcelFn:function(t,e,a){var n=this;i.a.post("/shop/discount/uploadGoodsIdList",t,e).then(function(t){if(1e3===t.data.code){var e=t.data.data,r=e.failGoodsList.join("，");return n.$alert("共 "+(e.failCount+e.successCount)+" 条数据, 成功 "+e.successCount+" 条, 失败 "+e.failCount+" 条，其中失败的商品ID为："+r+"。","处理结果",{confirmButtonText:"确定",callback:function(t){n.isEdit?n.num=(new Date).getTime():n.$router.push({name:"editFullActivity",params:{id:n.id||a.data.discountId}})}}),!1}n.$message.error(t.data.msg)}),this.$refs.fileBtn.value=""},addExcel:function(t){var e=this;this.form.start=Object(l.c)(this.form.dateRange[0]),this.form.end=Object(l.c)(this.form.dateRange[1]);var a=t.target.files[0],o=new FormData;o.append("fileGoodsId",a),o.append("token",Object(r.a)());var i={headers:{"Content-Type":"multipart/form-data",token:Object(r.a)()}};this.$refs.formRef.validate(function(t){if(!t)return!1;e.isEdit?(o.append("discountId",e.id),e.addExcelFn(o,i)):Object(n.a)(e.form).then(function(t){o.append("discountId",t.data.discountId),e.addExcelFn(o,i,t)})})},goBack:function(){this.isEdit?this.$router.push({name:"fullIndex"}):this.$router.history.go(-1)},addBtn:function(){var t=this;this.$refs.formRef.validate(function(e){e&&(t.visible=!0)})},onAdd:function(t){var e=this;if(this.GoodsSubmitStatus?this.GoodsSubmitStatus=!1:this.GoodsSubmitStatus=!0,this.form.start=Object(l.c)(this.form.dateRange[0]),this.form.end=Object(l.c)(this.form.dateRange[1]),!this.isEdit)return Object(n.a)(this.form).then(function(a){e.addActivityGoods(t,a.data.discountId)}),!1;this.addActivityGoods(t,this.id)},addActivityGoods:function(t,e){var a=this;console.log(e);var r=t.map(function(t){return t.id});console.log(r.join());var o={discountId:e,checkGoodsIds:r.join()};Object(n.b)(o).then(function(t){a.$message({type:"success",message:"活动商品添加成功"}),a.isEdit?a.num=(new Date).getTime():a.$router.push({name:"editFullActivity",params:{id:e}})}).catch(function(){a.loading=!1})},handleAvatarSuccess:function(t){this.form.icon=t.url},beforeAvatarUpload:function(t){var e=t.type.includes("jpg"),a=t.type.includes("jpeg"),n=t.type.includes("png"),r=t.size/1024<5120;return e||a||n||this.$message.error("请上传jpg,png格式的图片"),r||this.$message.error("上传图片大小不能超过5Mb!"),r&&(a||n||e)},beforeUpload:function(){this.btnLoading=!0,this.$message({message:"上传处理中，请耐心等待..."})},uploadSuccess:function(t){this.btnLoading=!1,1e3===t.code?(this.$alert(t.data,"处理完成",{confirmButtonText:"确定",callback:function(t){}}),this.handleCurrentChange(1)):this.$message({message:"上传处理错误，请重新尝试"})},getCurGoodData:function(t){var e=this.pageSize*(t-1),a=e+this.pageSize-1>this.goodData.length-1?this.goodData.length-1:e+this.pageSize-1;this.curGoodData=[];for(var n=e;n<=a;n++)this.curGoodData.push(this.goodData[n])},getFullActivity:function(){var t=this;Object(n.e)({id:this.id}).then(function(e){1e3===e.code?(t.form.id=e.data.id,t.form.name=e.data.name,t.form.type=e.data.type,t.form.dateRange=[new Date(e.data.start),new Date(e.data.end)],t.form.remark=e.data.remark,t.form.icon=null==e.data.icon?"https://img.51fanbei.com/h5/app/activity/full.png":e.data.icon,t.form.threshold=e.data.threshold,t.form.discountAmount=e.data.discountAmount,t.form.status=e.data.status,t.form.discountType=e.data.discountType,t.form.end=Object(l.c)(e.data.end),t.form.start=Object(l.c)(e.data.start),t.changeWord(t.form.type)):t.$message.error(e.msg)})},update:function(){var t=this;this.$refs.formRef.validate(function(e){if(!e)return!1;t.form.start=Object(l.c)(t.form.dateRange[0]),t.form.end=Object(l.c)(t.form.dateRange[1]),Object(n.K)(t.form).then(function(e){t.$message({type:"success",message:"保存成功"}),t.$router.push({name:"fullIndex"})})})},changeWord:function(t){switch(t){case"AMOUNT":this.typeTxt.name="元减",this.typeTxt.label="元";break;case"COUNT":this.typeTxt.name="件减",this.typeTxt.label="元";break;case"AMOUNTDISCOUNT":this.typeTxt.name="元打",this.typeTxt.label="折";break;case"COUNTDISCOUNT":this.typeTxt.name="件打",this.typeTxt.label="折";break;case"AMOUNTCOUNT":this.typeTxt.name="元任选",this.typeTxt.label="件";break;case"COUNTAMOUNT":this.typeTxt.name="件减",this.typeTxt.label="件";break;default:this.typeTxt.name="减",this.typeTxt.label="元"}return this.typeTxt}}},u={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"addCoupon"},[a("el-form",{ref:"formRef",attrs:{model:t.form,rules:t.rules}},[a("el-form-item",{attrs:{prop:"name",label:"规则名称："}},[a("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"type",label:"规则类型："}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:t.changeWord},model:{value:t.form.type,callback:function(e){t.$set(t.form,"type",e)},expression:"form.type"}},t._l(t.typeData,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("div",{staticClass:"setFull"},[a("el-form-item",{staticClass:"full",attrs:{prop:"threshold",label:""}},[t._v("\n        满 "),a("el-input",{model:{value:t.form.threshold,callback:function(e){t.$set(t.form,"threshold",e)},expression:"form.threshold"}})],1),t._v(" "),a("el-form-item",{staticClass:"reduce",attrs:{prop:"discountAmount",label:""}},[t._v("\n        "+t._s(t.typeTxt.name)+" "),a("el-input",{model:{value:t.form.discountAmount,callback:function(e){t.$set(t.form,"discountAmount",e)},expression:"form.discountAmount"}}),t._v(" "+t._s(t.typeTxt.label)+"\n      ")],1)],1),t._v(" "),a("el-form-item",{attrs:{prop:"",label:"活动状态："}},[a("el-radio-group",{model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[a("el-radio",{attrs:{label:"O"}},[t._v("开启")]),t._v(" "),a("el-radio",{attrs:{label:"C"}},[t._v("禁用")])],1)],1),t._v(" "),a("el-form-item",{attrs:{prop:"icon",label:"活动icon："}},[a("el-upload",{staticClass:"avatar-uploader",staticStyle:{width:"200px","background-color":"#fff"},attrs:{action:"/shop/upload/uploadFile","on-success":t.handleAvatarSuccess,"before-upload":t.beforeAvatarUpload,"show-file-list":!1}},[t.form.icon?a("img",{staticClass:"avatar",attrs:{src:t.form.icon}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),t._v(" "),a("p",[t._v("可自定义上传图片，图片尺寸为140*60，支持jpg/png格式")])],1),t._v(" "),a("el-form-item",{attrs:{prop:"remark",label:"规则说明："}},[a("el-input",{attrs:{placeholder:"该规则展示于商品详情页"},model:{value:t.form.remark,callback:function(e){t.$set(t.form,"remark",e)},expression:"form.remark"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"dateRange",label:"生效时间："}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.form.dateRange,callback:function(e){t.$set(t.form,"dateRange",e)},expression:"form.dateRange"}})],1),t._v(" "),a("el-form-item",{staticClass:"btnBox",attrs:{label:""}},[t.isAdd?a("el-button",{attrs:{type:"default"},on:{click:t.goBack}},[t._v("返回")]):t._e(),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.addBtn}},[t.isAdd?a("span",[t._v("新增商品")]):t._e(),t._v(" "),t.isEdit?a("span",[t._v("管理商品")]):t._e()]),t._v(" "),a("a",{staticClass:"fileBox",attrs:{href:"javascript:;"}},[t._v("\n        导入商品"),a("input",{ref:"fileBtn",attrs:{id:"fileBtn",name:"file",type:"file"},on:{change:t.addExcel}})]),t._v(" "),a("a",{staticClass:"muban",attrs:{target:"_blank",href:"http://f.51fanbei.com/test/6c0e6c7c8d72313f.xlsx"}},[t._v("excel模板下载")])],1),t._v(" "),a("GoodTable02",{attrs:{id:t.id,num:t.num}}),t._v(" "),t.isEdit?a("el-form-item",{staticClass:"btnBox",attrs:{label:""}},[a("el-button",{attrs:{type:"default"},on:{click:function(e){t.goBack()}}},[t._v("返回")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.update}},[t._v("保存")])],1):t._e()],1),t._v(" "),a("GoodsSelect",{attrs:{isShow:t.visible,onSubmit:t.onAdd},on:{"update:isShow":function(e){t.visible=e}}})],1)},staticRenderFns:[]};var m=a("VU/8")(c,u,!1,function(t){a("fSUW")},"data-v-ca90963a",null);e.a=m.exports},Fqci:function(t,e,a){(t.exports=a("FZ+f")(!1)).push([t.i,"\n[data-v-ca90963a] label {\n  width: 120px;\n}\n[data-v-ca90963a] .el-form-item__content {\n  padding-left: 121px;\n}\n[data-v-ca90963a] .el-form-item__error {\n  padding-left: 121px;\n}\n.el-input[data-v-ca90963a] {\n  width: 400px;\n}\n.el-select[data-v-ca90963a] {\n  width: 400px;\n}\n.el-form-item.is-success[data-v-ca90963a] .el-input__inner {\n  border-color: #dcdfe6;\n}\n.btn[data-v-ca90963a] {\n  padding-top: 20px;\n}\n.el-form[data-v-ca90963a] {\n  padding-left: 20px;\n}\n.dateTo[data-v-ca90963a] {\n  padding: 10px 25px 0;\n}\n[data-v-ca90963a] .el-range-separator {\n  width: 7%;\n}\n.imgBox img[data-v-ca90963a] {\n  max-height: 60px;\n  max-width: 80px;\n}\n.avatar-uploader[data-v-ca90963a] {\n  display: inline-block;\n  border: 1px dashed #d9d9d9;\n  border-radius: 6px;\n  cursor: pointer;\n  position: relative;\n  overflow: hidden;\n}\n[data-v-ca90963a] .avatar-uploader .el-upload {\n  display: block;\n  padding-top: 12px;\n}\n.avatar-uploader .el-upload[data-v-ca90963a]:hover {\n  border-color: #409EFF;\n}\n.avatar-uploader-icon[data-v-ca90963a] {\n  font-size: 28px;\n  color: #8c939d;\n  width: 178px;\n  height: 178px;\n  line-height: 178px;\n  text-align: center;\n}\n.avatar[data-v-ca90963a] {\n  width: 140px;\n  height: 60px;\n}\n.setFull .reduce[data-v-ca90963a] {\n  padding-left: 0px;\n}\n.setFull .reduce[data-v-ca90963a] .el-form-item__content {\n  padding-left: 0px;\n}\n.setFull .reduce[data-v-ca90963a] .el-form-item__error {\n  padding-left: 17px;\n}\n.setFull .el-form-item[data-v-ca90963a] {\n  display: inline-block;\n}\n.setFull .el-form-item .el-input[data-v-ca90963a] {\n  width: 100px;\n}\n.btnBox[data-v-ca90963a] {\n  margin-top: 35px;\n}\n.fileBox[data-v-ca90963a] {\n  position: relative;\n  top: 13px;\n  left: 10px;\n  /*cursor: pointer;*/\n  display: inline-block;\n  background: #D0EEFF;\n  border: 1px solid #99D3F5;\n  border-radius: 4px;\n  padding: 7px 20px;\n  overflow: hidden;\n  color: #1E88C7;\n  text-decoration: none;\n  text-indent: 0;\n  line-height: 20px;\n}\n.fileBox input[data-v-ca90963a] {\n  position: absolute;\n  font-size: 100px;\n  right: 0;\n  top: 0;\n  opacity: 0;\n}\n.muban[data-v-ca90963a] {\n  padding-left: 20px;\n}\n",""])},OiyS:function(t,e,a){var n=a("4xdC");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);a("rjj0")("366bf2f2",n,!0)},fSUW:function(t,e,a){var n=a("Fqci");"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);a("rjj0")("51f59da2",n,!0)},uBFe:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n={data:function(){return{}},methods:{},components:{PulicForm:a("Cn0+").a}},r={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"addAct"},[e("PulicForm",{attrs:{isAdd:!0}})],1)},staticRenderFns:[]};var o=a("VU/8")(n,r,!1,function(t){a("OiyS")},"data-v-30f34cad",null);e.default=o.exports}});